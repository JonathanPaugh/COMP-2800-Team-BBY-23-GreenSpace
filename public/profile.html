<!DOCTYPE html>
<html>

<head>
    <title>GreenSpace</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="css/profile.css">
</head>


<body>
    <div class="head"></div>
    <div class="wrapper">
        <div class="row1A">
            <div class="part1">profile image
                <div class="circle2">
                </div> 
            </div>
            <div class="row1-page1-part2">
                <div class="pro-info">
                    <p><span id="fp" class ="col-sm-4">First Name: </span><span id="pro-fname" >Sample First</span></p>
                    <p><span id="fp">Last Name:</span><span id="pro-lname" >Sample Last</span></p>
                    <p><span id="fp">Email:</span><span id="pro-email">firstLast@gmail.com</span></p>
                    <p><span id="fp">Website:</span><span id="pro-web" >www.123.com</span></p>
                    <p><span id="fp">Biography:</span><span id="pro-bio" >graphic designer</span></p>
                    <input type="submit" id="MyButton" value="Edit" onClick="location.href='/profile-2.html'">
                </div>                
            </div>
        </div>
        <div class="row2">
            <div class="nav_menu">
                <ul>
                    <li onclick="clickParts(0)" class="user-post true">
                        Posts
                    </li>
                    <li onclick="clickParts(1)" class="user-favorites">
                        Collections
                    </li>
                    <li onclick="clickParts(2)" class="user-favorites">
                        Gallery
                    </li>
                </ul>
            </div>
            
            <div class="blog-section click-part-content">
                <div class="section-title">My Posts</div>
                <div class="section-create" style="height: 36px; ">
                    <input type="submitPost" id="MyButtonPost" onclick="openTab()" style="font-size: 22px;" value="Create A Post" readonly="readonly" onClick="location.href='#'">
                </div>
                <!-- The Modal -->
                <div id="myModal" class="modal">

                    <!-- Modal content -->
                    <div class="modal-content">
                        <p class="close" onclick="closeTab()" style="font-size: 50px;">&times;</p>
                        <div class="modal-box">
                            
                            <div class="modal-title">
                                <input type="text" class="form-control ph-title" placeholder="Blog Title">
                            </div>
                            <div class="modal-text">
                                <textarea class="form-control placehold" aria-label="With textarea" placeholder="Write your post here..."></textarea>
                                <button class="buttons-right blog-posted" onclick="createBlog()" style="font-size: 24px; float: right; margin-right: 15px; background-color:  #4d7e65 ">Post</button>
                                <!-- <p style="color: black">Some text in the Modal..</p> -->
                            </div>
                            
                            <!-- <div class="modal-date"></div> -->
                        </div>
                    </div>

                </div>
                <div class="blogs"></div>
            </div>
            <div class="collection click-part-content">
                hello2
            </div>
            <div class="gallery click-part-content">
                hello3
            </div>

        </div>
        <!-- <div class="col-1A">
            <div class="profile">
                hello profile
            </div>
        </div>
        <div class="col-2B">
            <div class="content">
                .
                <div class="text">
                    <h5 id="post-titles">My Posts</h5>
                    <div class="blogs-containter"></div>      
                </div>
            </div>
        </div> -->
    </div>
    
    <!-- Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0" crossorigin="anonymous">
        </script>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous">
        </script>

    <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/ui/4.6.1/firebase-ui-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-storage.js"></script>

    <script src="/js/general.js"></script>
    <script src="/js/firebase.js"></script>
    <script src="/js/init.js"></script>

    <!-- Scripts -->
    <script>
        // clickpart(0)
        $(document).ready(()=>{

            showBlogs();
           
            // $('#MyButton').click(profile);
            changeTab();
            getProfile();
            getModal();
        })

        /*
        * Reference begins: 
        * @see https://www.youtube.com/watch?v=PJe5Cc6iybQ
        */
        function changeTab(){
            $('.nav_menu ul li').click(()=>{
                $(this).addClass('true').siblings().removeClass('true');
            })
        }
        // var button = document.querySelectorAll('.nav_menu ul li');
        var part_content = document.querySelectorAll('.click-part-content');
        function clickParts(i) {
            part_content.forEach(part=>{
                part.style.display='none';
            });
            part_content[i].style.display = 'block';
        }
        clickParts(0);
        /*
        * Reference ends
        */
                       
        const modal = document.getElementById("myModal");
        function getModal(){
            // clicks anywhere outside 
            window.onclick = function(event) {
                  if (event.target == modal) {
                 modal.style.display = "none";
                 }
            }
        }
        function closeTab() {
            modal.style.display = "none";
        }

        function openTab() {
            modal.style.display = "block";
        }
        function createBlog() {
            var now = new Date;
var utc_timestamp = Date.UTC(now.getUTCFullYear(),now.getUTCMonth(), now.getUTCDate() , 
      now.getUTCHours(), now.getUTCMinutes(), now.getUTCSeconds(), now.getUTCMilliseconds());
            database.collection("profile_post_collections").add({
                blog_title: $(".ph-title").val(),
                blog_text: $(".placehold").val(),
                
                date: firebase.firestore.Timestamp.fromDate(new Date())
            })
            .then((docRef) => {
               console.log("Document written with ID: ", docRef.id);
                readBlog(docRef.id);
            })
            .catch((error) => {
              console.error("Error adding document: ", error);
            });
        }
        function readBlog(id) {
            database.collection("profile_post_collections").doc(id).get().then(doc=>{
                makeBlog(id, doc.data());
            })
        }
        
        function getProfile() {
            withUser(user=>{
                $('#pro-fname').html(user.data().first_name);
                $('#pro-lname').html(user.data().last_name);
                $('#pro-email').html(user.data().email);
                $('#pro-web').html(user.data().website);
                $('#pro-bio').html(user.data().bio);
            })
            
        }

        // function displayPost() {
        //     database.collection("threads").doc(id).get().then(post => {
        //         createPost(post.data().topic, post.data().content, post.data().user);
        //     });
        // }

        // function createPost(topic, content, user) {
        //     fetchTemplate("thread-post.html", data => {
        //         let post = $(data).appendTo(".thread-post");
        //         post.find(".post-topic").html(topic);
        //         post.find(".post-content").html(content);

        //         if (user) {
        //             database.collection("users").doc(user).get().then(user => {
        //                 post.find(".post-user").html(user.data().name);
        //             });
        //         }
        //     });
        // }
        function showBlogs() {
            database.collection("profile_post_collections").get().then((blogs)=>{
                blogs.docs.forEach((blog)=>{
                    makeBlog(blog.id, blog.data());
                    console.log("check: ", blog.data().date)
                })
               
            });
        }

        function makeBlog(id, box) {
            
            fetchTemplate("profile-blog.html", card=>{
               let each = $(card);
               each.find(".blog-title").html(box.blog_title);
               each.find(".blog-content").html(box.blog_text);  
               each.find(".date").html(box.date.toDate().toLocaleString());
               $(".blogs").prepend(each);
            });
        }
    
    </script>


</body>

</html>